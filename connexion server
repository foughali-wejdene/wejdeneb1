from tkinter import *

#fenetre = Tk()
#fenetre.title('essai')
#fenetre.geometry('350x300')

import socket
import select
import threading
import time


hote = ''
port = 8085
 
connexion_principale = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
connexion_principale.bind((hote, port))
connexion_principale.listen(5)
print("Le serveur écoute à présent sur le port {}".format(port))
 

def thread_function(name):

    clients_connectes = []

    while True:

        connexions_demandees, wlist, xlist = select.select([connexion_principale], [], [], 0.05)

        for connexion in connexions_demandees:
            connexion_avec_client, infos_connexion = connexion.accept()
            # On ajoute le socket connecté a  la liste des clients
            clients_connectes.append(connexion_avec_client)

        clients_a_lire = []
        clients_a_informer = []

        try:
            clients_a_lire, clients_a_informer, xlist = select.select(clients_connectes,clients_connectes, [], 0.01)
        except select.error:
            pass
        else:
            # On parcourt la liste des clients a  lire
            for client in clients_a_lire:
                client.send("Bien recu")
                # Client est de type socket
                msg_recu = client.recv(1024)
                # Peut planter si le message contient des caracteres speciaux
                msg_recu = msg_recu.decode()
                print("Recu{}".format(msg_recu))



if __name__ == "__main__":

    x = threading.Thread(target=thread_function, args=(1,))
    x.start()
